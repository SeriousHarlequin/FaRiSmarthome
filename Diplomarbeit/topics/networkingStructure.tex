\chapter{Networking}
\section{Communication Protocols}
    \subsection{MQTT}
    MQTT is an OASIS standard messaging protocol for 
    IoT-Applications that builds on top of TCP/IP and 
    works on a publish/subscribe model, which makes it easy
    to set up communication between devices without knowing
    their IP-Addresses. It requires a dedicated broker to
    function, that can be set up as a service on the 
    Raspberry Pi \cite{mqtt_nodate}.
    One mayor upside of using MQTT is that it is compatible
    with every, in this smart home involved, device.


    \subsection{ESP NOW} 
    ESP-NOW is a wireless communication protocol capable of
    working with Wi-Fi and Bluetooth. It supports a 
    multitude of Espressif microcontrollers and is widely 
    used in IoT-Applications. The main advantage of using
    ESP-NOW is that is requires no router or existing
    network to function meaning it's not dependent on
    a good Wi-Fi coverage. While indoor use drastically
    reduces the range of 200m per unit depending on various
    factors \cite{esp-now-reach_2024} 
    the integrated multihop feature that allows the devices 
    to relay messages to each other can be used to extend 
    the range to hard-to-reach locations.\\~\\
    Due to the listed advantages, ESP-NOW is the \textbf{preferred
    communication protocol} for this project.


\section{Node-to-Server Communication}
Due to the fact that ESP-NOW is exclusive to Espressif microcontrollers,
a bridge between the nodes and the server is needed. This bridge can be 
routed through a preexisting Network as the Web server requires 
one anyway.

    \subsection{MQTT}
    MQTT can be used to bridge the gap between the nodes and the server.
    The server can subscribe to the same topics as the nodes, and the nodes
    can publish to the same topics as the server.

        \subsubsection{Disadvantages}
        Unfortunately, MQTT integration for the Web server as well as the database
        is not as straightforward as the alternative and would require a lot more 
        overhead.

    \subsection{HTTP}
    HTTP can be used to bridge the gap between the nodes and the server.
    This way a dedicated Node can be set up to handle the communication
    with both the Web server and the database and distribute it to the 
    rest of the nodes.

    \vspace{1cm}
    \textbf{For this project, HTTP is the preferred protocol for 
    node-to-server communication.}

    \section{Networking Structure}
    The Nuxt.js Web server will function as a main broker between
    the Database and a dedicated ESP32 device that  acts
    as a bridge between every ESP32 and the Nuxt.js Web server.
    This is done because a single ESP32 device can only handle
    either ESP-NOW or a standard Wi-Fi connection, but not both
    simultaneously. This dedicated bridge is a special 
    ESP32-Board with both a Wi-Fi antenna and an Ethernet port,
    enabling it to do both at the same time. 

